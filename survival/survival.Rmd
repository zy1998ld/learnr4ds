---
title: "A doc for data visa of survival by survminer"
author: "[Zyang](https://github.com/zy1998ld)"
date: "`r format(Sys.time(), '%D')`"
mail: "zy1794148812@gmail.com"
linkedin: "Zyang-1998"
twitter: "zy"
github: "zy1998ld"
home: "www.zy.meng.ga"
logo: "logo_gallery.png"
output:
  epuRate::epurate:
    toc: TRUE
    number_sections: FALSE
    code_folding: "hide"
---


<br><br>

> Date visalition for survival analysis may divided into 3 parts,described in [survminer](https://rpkgs.datanovia.com/survminer/reference/index.html)


# Get the lung data
***
Always start by loading *survival*. The [survival](https://www.tidyverse.org) is officially the package used for survival analysis. [survminer](https://rpkgs.datanovia.com/survminer/reference/index.html) is used for imaging by ggplot. It is a good practice to load all the packages in the same time.
```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(rmarkdown)    
library(epuRate)    
library(survival)
library(survminer)
```

Then I explain what is my input data and I load lung datasheet. Here is how it looks like:
```{r}
lung %>% head(5)
```

This file has `r nrow(mtcars)` lines and `r ncol(mtcars)` columns. It is ready to be analysed.





# Data visalition
***
Here are 3 parts of a [survival plot](https://rpkgs.datanovia.com/survminer/survminer_cheatsheet.pdf) that you can find in the [survminer cheatsheet](https://rpkgs.datanovia.com/survminer/survminer_cheatsheet.pdf).  

## Survival Curver
`ggsurvplot()`is a generic function to plot survival curves. Wrapper around the `ggsurvplot_xx()` family functions. Plot one or a list of `survfit` objects as generated by the `survfit`.`formula()` and `surv_fit` functions

```{r, warning=FALSE, fig.align='center' }
#model buliding
fit <- survfit(Surv(time,status) ~ sex, data = lung)

#survival plot
fit %>% 
  ggsurvplot(fun = 'pct',
            pval = T, #add p-value
            risk.table = T, #add risk table
            risk.table.col = 'strata',
            tables.height = 0.2,
            tables.theme = theme_cleantable(),
            surv.median.line = 'hv',
            conf.int = T,
            legend.title = 'sex',
            legend.labs = c('male','female'))
```

### facet plot
The output of `ggsurvfit` includes plot and tables,`facet-grid` can separately facet one of them. Facet plot and tables can see in [survminer](https://rpkgs.datanovia.com/survminer/reference/index.html)

```{r,warning=FALSE,fig.align='center'}
##model buliding
fit2 <- survfit(Surv(time,status)~ sex + rx + adhere, data = colon)

##survival plot
ggsurvplot(fit = fit2,fun = 'cumhaz',
           pval = T,
           risk.table = T,
           conf.int = TRUE,
           risk.table.col = 'strata')$plot + 
  facet_grid(rx~adhere)

```

## Diagnostics of Cox Model
The function cox.zph() from survival package may be used to test the
proportional hazards assumption for a Cox regression model fit.

###  ggcoxzph() 
For each covariate it produces plots with scaled Schoenfeld residuals against the time.
```{r, warning=FALSE, fig.align='center' }
## model buliding
fit3 <- coxph(Surv(time, status) ~ sex + age, data = lung)

## plot
ggcoxzph(cox.zph(fit3),font.min = 12)
```

### ggcoxdiagnostics()
The function `ggcoxdiagnostics()` plots different types of residuals as a
function of time, linear predictor or observation id. 

> The **type** of residual is selected with type argument. Possible values are "martingale", "deviance", "score", "schoenfeld", "dfbeta"', "dfbetas", and "scaledsch".

>The **ox.scale** argument defines what shall be plotted on the OX axis.
Possible values are "linear.predictions", "observation.id", "time".

>Logical arguments **hline** and **sline** may be used to add horizontal line or smooth line to the plot.

```{r, warning = FALSE, fig.align = 'center'}
ggcoxdiagnostics(fit = fit3,
                 type = 'deviance',
                 ox.scale = 'linear.predictions')

```


## Summary of Cox Model
The function ggforest() from the survminer package creates a forest plot
for a Cox regression model fit. Hazard ratio estimates along with confidence intervals and p-values are plotter for each variable.

```{r, warning=FALSE, fig.align='center' }
# Create dataset

fit4 <- coxph(Surv(time,status)~sex + ph.ecog,data = lung)

ggforest(fit4)

```





